<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIAGN칍STICO ITALL - Sistema de Vendas</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-6">

    <header class="mb-8 border-b border-gray-700 pb-4">
        <h1 class="text-2xl font-black text-blue-400 italic">ITALL CAMPO - MODO DIAGN칍STICO</h1>
        <p class="text-gray-400 text-sm">Status da Conex칚o em Tempo Real</p>
    </header>

    <div id="painel-diagnostico" class="space-y-4 mb-8">
        <div class="bg-gray-800 p-4 rounded-xl border border-gray-700">
            <p class="text-xs uppercase text-gray-500 font-bold mb-2">1. Status do Proxy (Heroku)</p>
            <div id="status-proxy" class="text-yellow-500 font-bold">Verificando...</div>
        </div>

        <div class="bg-gray-800 p-4 rounded-xl border border-gray-700">
            <p class="text-xs uppercase text-gray-500 font-bold mb-2">2. Resposta da Omie (API)</p>
            <div id="status-omie" class="text-yellow-500 font-bold text-xs break-all italic">Aguardando chamada...</div>
        </div>

        <div class="bg-gray-800 p-4 rounded-xl border border-gray-700">
            <p class="text-xs uppercase text-gray-500 font-bold mb-2">3. Filtro de Produtos (Tipo 00)</p>
            <div id="status-produtos" class="text-yellow-500 font-bold text-xs italic italic italic italic">Aguardando dados...</div>
        </div>
    </div>

    <div id="lista-vitrine" class="grid grid-cols-1 gap-4">
        </div>

    <script>
        const CONFIG = { key: '4695613971048', secret: 'adcacd22b1c64d9520965dac570b3afd' };
        const PROXY = "https://cors-anywhere.herokuapp.com/";

        async function rodarDiagnostico() {
            const statusProxy = document.getElementById('status-proxy');
            const statusOmie = document.getElementById('status-omie');
            const statusProdutos = document.getElementById('status-produtos');

            try {
                // TESTE 1: PROXY
                statusProxy.innerText = "游리 Testando t칰nel...";
                const resProxy = await fetch(PROXY + "https://google.com", { method: 'HEAD' });
                if (resProxy.ok) {
                    statusProxy.innerText = "游릭 PROXY ATIVO E LIBERADO";
                    statusProxy.className = "text-green-500 font-bold";
                }

                // TESTE 2: OMIE
                statusOmie.innerText = "游리 Chamando Omie...";
                const resOmie = await fetch(PROXY + "https://app.omie.com.br/api/v1/geral/produtos/", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        "call": "ListarProdutos",
                        "app_key": CONFIG.key, "app_secret": CONFIG.secret,
                        "param": [{"pagina": 1, "registros_por_pagina": 10, "inativo": "N", "filtrar_apenas_tipo": "00"}]
                    })
                });

                const data = await resOmie.json();
                
                if (data.faultstring) {
                    statusOmie.innerText = "游댮 ERRO NA OMIE: " + data.faultstring;
                    statusOmie.className = "text-red-500 font-bold";
                } else if (data.produto_servico_cadastro) {
                    statusOmie.innerText = "游릭 OMIE RESPONDEU COM SUCESSO";
                    statusOmie.className = "text-green-500 font-bold";
                    
                    const qtd = data.produto_servico_cadastro.length;
                    statusProdutos.innerText = `游릭 ENCONTRADOS ${qtd} PRODUTOS DE REVENDA (TIPO 00)`;
                    statusProdutos.className = "text-green-500 font-bold";
                    
                    renderTeste(data.produto_servico_cadastro);
                } else {
                    statusProdutos.innerText = "游댮 NENHUM PRODUTO TIPO 00 ENCONTRADO";
                    statusProdutos.className = "text-orange-500 font-bold";
                }

            } catch (e) {
                statusProxy.innerText = "游댮 PROXY BLOQUEADO OU EXPIRADO. ACESSE cors-anywhere.herokuapp.com/corsdemo";
                statusProxy.className = "text-red-500 font-bold";
                console.error(e);
            }
        }

        function renderTeste(itens) {
            const lista = document.getElementById('lista-vitrine');
            itens.forEach(p => {
                const card = document.createElement('div');
                card.className = 'bg-white text-black p-4 rounded-xl flex justify-between';
                card.innerHTML = `<span>${p.descricao}</span><span class="font-bold text-blue-600">R$ ${p.valor_unitario}</span>`;
                lista.appendChild(card);
            });
        }

        rodarDiagnostico();
    </script>
</body>
</html>
